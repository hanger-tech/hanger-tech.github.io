<!DOCTYPE html>
<html>
	<head><title>Apacheで全体の共通設定は主サーバ設定に | はんがーの備忘録</title>
<meta charset="UTF-8" />
<meta http-equiv="Content-Language" content="ja" />
<meta name="viewport" content="width=device-width, initial-scale-1.0" />
<meta name="description" content="はんがーが内容を見返すためのサイト" />
<meta name="author" content="はんがー" />
<meta name="robots" content="index, follow" />
<meta name="google-adsense-account" content="ca-pub-9916094978890818"/>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9916094978890818"
     crossorigin="anonymous"></script>
<link rel="stylesheet" href="/scss/main.min.css">

<link rel="icon" href="/favicon.icon" />
</head>
    <body>
		<div class="layout-wrapper">
			<header class="site-header"><div class="container">
 <h2 class="logo">
  <a href="/">はんがーの備忘録</a>
 </h2>
 <nav class="nav">
  <a href="/" class="nav-link">TOP</a>
  <a href="/about" class="nav-link">About</a>
  <a href="/contact" class="nav-link">Contact</a>
 </nav>
</div>
</header>

			<div class="ad-mobile"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9916094978890818"
     crossorigin="anonymous"></script>

<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9916094978890818"
     data-ad-slot="7505991866"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

			<main class="main-layout">
				<article class="content">
 <h2 class="title">Apacheで全体の共通設定は主サーバ設定に</h2>
 <p>.htaccessに書くと処理能力やセキュリティの低下を招く可能性があります。</p>
<p>詳しくはApacheの公式チュートリアルにあります。</p>
<p><a href="https://httpd.apache.org/docs/2.4/ja/howto/htaccess.html#when">Apache チュートリアル（Ver 2.4）</a></p>
<p>公式サイトにも記載がありますが、まず最初に処理能力が低下する理由です。
【AllowOverride】ディレクティブで【.htaccess】を使用出来る状態になってい場合は、Apache は 各ディレクトリで【.htaccess】ファイルを探します。
仮に「/hoge/huga/index.html」へのリクエストがあり【AllowOverride】と【.htaccess】の有効範囲が「/」以下ならば</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">/.htaccess
/hoge/.htaccess
/hoge/huga/.htaccess
/hoge/huga/index.html
</code></pre></td></tr></table>
</div>
</div><p>の順に【.htaccess】を読み込みます。</p>
<p>実際に【.htaccess】ファイルがあろうがなかろうが【.htaccess】を有効にしているディレクトリ及びサブディレクトリにアクセスします。特に問題なのは【.htaccess】ファイルがない場合もファイルシステム的にはアクセスするので無駄なオーバーヘッドがあります。</p>
<p>そしてこの処理はリクエストが来るたびに毎回行われます。
デフォルトの【httpd.conf】ファイル上では「/」ディレクティブは【AllowOverride none】となっており通常は、意図的に変更してなければ気にしなくても大丈夫です。</p>
<p>2つ目のセキュリティに関してですが、これは単純で設定ファイルを集約せずに拡散させていると管理が複雑になり何をどう変更して実行しているのかわからなくなるからです。最近は「ロリポップ」や「Freedom Hosting II」へのシンボリックリンク攻撃なども行われています。</p>
<p><a href="https://fumiyas.github.io/2013/09/03/no-followsymlinks-is-not-safe.html">Apache HTTPD: Options -FollowSymLinks は不完全</a></p>
<p><a href="https://it.srad.jp/story/17/02/15/0626201/">Torなどの匿名化技術を使って構築された「ダークウェブ」上のホスティングサービスがハックされデータ流出</a></p>
<p>サーバ共通の設定を主設定、もしくは主設定がインクルードするファイルに設定保存すると、管理も複雑化しにくくなります。</p>
<p>主サーバ設定は起動時に1回だけ読み込まれ、それ以降は読み込まれないので負荷の軽減になります。</p>
</article>


				<aside class="sidebar">
					<div class="ad-desktop"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9916094978890818"
     crossorigin="anonymous"></script>

<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9916094978890818"
     data-ad-slot="7505991866"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

					</div>
				</aside>
			</main>
			<footer class="site-footer"><div class="container">
 <div class="copylight">
  &copy; はんがー 
   2025
  
 </div>
</div>
</footer>
		</div>
    </body>
</html>
